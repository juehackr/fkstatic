var ylyw = jq('#texsyldmal').val();
var scyw = jq('#texsscdmal').val();

var ylywjd = jq('#texsyldmjd').val();
var scywjd = jq('#texsscdmjd').val();

function closeWindowr(time) {
    jq('#texsscdm').attr("disabled", "true");
    jq('#texsyldm').attr("disabled", "true");
    jq('#texsyldmal').attr("disabled", "true");
    jq('#texsscdmal').attr("disabled", "true");
    jq('#texsyldmjd').attr("disabled", "true");
    jq('#texsscdmjd').attr("disabled", "true");
    if (time > 0) {
        jq('#texsscdm').attr("value", '请等待' + time + '秒');
        jq('#texsyldm').attr("value", '请等待' + time + '秒');
        jq('#texsyldmal').attr("value", '请等待' + time + '秒');
        jq('#texsscdmal').attr("value", '请等待' + time + '秒');
        jq('#texsyldmjd').attr("value", '请等待' + time + '秒');
        jq('#texsscdmjd').attr("value", '请等待' + time + '秒');
        //jq(".sdlogin").html('<img src="static/image/common/loading.gif">'+time+'秒后'');

        time--;
        window.setTimeout('closeWindowr(' + time + ')', 1000);
    } else {
        jq('#texsscdm').removeAttr("disabled");
        jq('#texsscdm').attr("value", '生成代码');
        jq('#texsyldm').removeAttr("disabled");
        jq('#texsyldm').attr("value", '生成并预览效果');

        jq('#texsyldmal').removeAttr("disabled");
        jq('#texsyldmal').attr("value", ylyw);
        jq('#texsscdmal').removeAttr("disabled");
        jq('#texsscdmal').attr("value", scyw);

        jq('#texsyldmjd').removeAttr("disabled");
        jq('#texsyldmjd').attr("value", ylywjd);
        jq('#texsscdmjd').removeAttr("disabled");
        jq('#texsscdmjd').attr("value", scywjd);
    }
};

if (jq(".uesvip.novip").length > 0 && jq("#texsscdmalsc").length > 0) {
    jq(".sj_code_btn").attr('id', 'tonovip');
    jq(".sj_code_btn").attr('name', 'tonovip');
    jq('#tonovip').click(function () {
        zanzhu();
        return false;
    });
};


var mytools = {
    webdebugger: {
        Webtest: function (neoron) {
            var win = window.open();
            win.document.open();
            win.document.write(neoron);
            win.document.close();
        }
    }
};



function yulandaima(reszi) {
    var neyyss = jq('#scdm_html').val();
    if (neyyss.indexOf("&amp;gt;") < 1 && neyyss.indexOf("&gt;") < 0 && neyyss.indexOf(">") < 0) {
        return false;
    }

    if (jq('#scdm_html').val() == "") {
        var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'>请先生成代码再预览效果！</div></div>");
        jq("body").find(".copy-tips").remove().end().append(copysuc);
        jq(".copy-tips").fadeOut(3000);
        return false
    }
    var postdta = "";
    if (reszi != "") {
        postdta = reszi;
    } else {
        postdta = jq('.scdm_html').val();
    }


    if (jq('div').is('#dplx')) {
        var dplxs = jq("input[name='dplx']:checked").val();
    } else {
        var dplxs = 4;
    }


    jq.post("/static/yulandaima/yulan.php", {
            leix: dplxs,
            data: htmlDecode(postdta),
        },
        function (data, status) {
            var yldm = htmlDecode(data);
            var rest2 = new RegExp("alquot", "g");
            yldm = yldm.replace(rest2, "&quot;");

            var copysuc = jq("<div class='copy-yltips'><div class='copy-yltips-wrap'><input type='button' value='预览窗口打开失败,请点击此按钮预览效果！' name='sddkyl' id='sddkyl' class='btn-ok'><a href='http://www.mgzxzs.com/tmtbzxjc/644.html' class='szblj'  target='_blank'>点击查看设置预览窗口不被拦截的方法</a></div></div>");
            jq("body").find(".copy-yltips").remove().end().append(copysuc);

            jq('.copy-yltips #sddkyl').click(function () {
                mytools.webdebugger.Webtest(yldm);
                jq(".copy-yltips").fadeOut(2);
            });
            jq('.copy-yltips a').click(function () {
                jq(".copy-yltips").fadeOut(2);
            });

            mytools.webdebugger.Webtest(yldm);
            jq(".copy-yltips").fadeOut(2);

        });
};



function htmlEncode(value) {
    var neiron = value;
    if (neiron.indexOf("&amp;gt;") >= 1) {
        return neiron;
    } else {
        return jq('<div />').text(value).html();
    }
}

function htmlDecode(value) {
    var neiron = value;
    if (neiron.indexOf("&amp;gt;") >= 1 || neiron.indexOf("&gt;") >= 1) {
        return jq('<div />').html(neiron).text();
    } else {
        return neiron;
    }

}

jq('#qkbbsj').click(function () {
    jq('.bbcs input.input-box,.textarea-box').val("");
})

//取图片尺寸填写
function psize(obj, sx) {
    var sSrc = obj.value;
    if (IsURL(sSrc)) {
        jq("<img/>").attr("src", sSrc).load(function () {
            imgWidth = this.width;
            imgHeight = this.height;
            ttIsURL(sSrc);

            if (sx == 1) {
                jq("#show_height").val(imgHeight);
                jq("#show_width").val(imgWidth);

                jq('[name="show_height"]').val(imgHeight);
                jq('[name="show_width"]').val(imgWidth);

                if (jq("#show_width").val() > 952 || jq('[name="show_width"]').val() > 952) {
                    jq('#jiaruqps').attr('checked', 'checked');
                } else {
                    jq('#jiaruqps').removeAttr('checked');
                }

            } else if (sx == 2) {
                jq("#jiantougao").val(imgHeight);
            } else if (sx == 3) {
                jq("#show_width").val(imgWidth);
                var thisid = obj.id;
                var reg = /\d+/;
                var r = thisid.match(reg);
                jq("#picsiz" + r).val(imgHeight);
                jq("#show_height").val(jisuanh());
                jq('[name="show_height"]').val(jisuanh());
            }
        });
    }

}

//调整指定class尺寸
function classsize(objs, claid) {
    var cikeboj = objs;
    var sSrc = cikeboj.value;
    if (IsURL(sSrc)) {
        jq("<img/>").attr("src", sSrc).load(function () {
            imgWidth = this.width;
            imgHeight = this.height;

            jq("." + claid).css({
                "background": 'url(' + sSrc + ')',
                "width": imgWidth,
                "height": imgHeight,
                "line-height": imgHeight
            });


        });



    }
};


function jisuanh() {
    var gddddd = 0;
    for (var i = 1; i <= jq("#picbox .control-group").length; i++) {
        gddddd = gddddd + Math.floor(jq("#picsiz" + i).val());

    }
    return gddddd;
}





function ttIsURL(csss) {
    if (jq('div').is('#dmspmk')) {
        jq("#dmspmk").css({
            "background": 'url(' + csss + ')',
            "width": imgWidth,
            "height": imgHeight
        });
    }
}


function IsURL(bgurl) {
    var strRegex = "((^http)|(^https)|(^ftp)):\/\/(\\w)+\.(\\w)+";
    var re = new RegExp(strRegex);
    if (re.test(bgurl)) {
        return true;
    } else {
        return false;
    }
}



jq('label#jrqpx').click(function () {
    if (jq("#jiaruqp").get(0).checked) {
        jq('label#jrqpx').attr('class', 'jrqpdaim');
    } else {
        jq('label#jrqpx').attr('class', 'checked');
    }
});



function piaofuyangs(id) {
    var objS = document.getElementById(id);
    var grade = objS.options[objS.selectedIndex].value;
    var clid = id.replace(/[^0-9]/ig, "");
    if (grade == "自定义样式") {
        //alert();	 
        jq('#zdyp' + clid).removeAttr("disabled");
    } else {
        jq('#zdyp' + clid).attr("disabled", "true");
    }
}





//ty模块ps

function tysc(ipss) {


    if (jq('textarea').is('#html_img') || jq('input').is('#html_img')) {
        if (!tycheck2()) {
            return false;
        }
    } else {
        if (!tycheck()) {
            return false;
        }

    }

    jq('#scdm_html').val('');
    jq(".fuzhi").hide();
    jq("#texsfzdm").hide();
    jq(".zclip").hide();　
    if (ipss == 0) {
        var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='dd'></i>预览代码生成中,请稍后...</div></div>");
        jq("body").find(".copy-tips").remove().end().append(copysuc);
    } else {
        var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='dd'></i>代码生成中,请稍后...</div></div>");
        jq("body").find(".copy-tips").remove().end().append(copysuc);

    }


    var formdata = jq('#shetsps').serialize()

    if (jq('label').is('#jrqpx')) {
        if (jq("#jiaruqp").get(0).checked) {
            formdata = formdata + "&jrqp=1";
        } else {
            formdata = formdata + "&jrqp=0";
        }
    }


    jq.ajax({
        type: 'post',
        url: "portal.php?mod=fktools&aid=" + aid + "&formhash=" + jq("#yformhash").html() + "&ajax=1", //拼接
        data: formdata,
        error: function () {
            alert('生成出错请检查您的设置');
        },
        success: function (html) {
            rs = eval("(" + html + ")");
            jq('#scdm_html').val('');
            var rest = new RegExp("iquoti", "g");
            var rest2 = new RegExp("&quot;", "g");

            var lur = rs['jieguo'];
            var rest5 = new RegExp("sttaig", "g");
            lur = lur.replace(rest5, 'stt' + discuz_uid + 'aig');

            var restjpg = new RegExp('.jpg"', "g");
            lur = lur.replace(restjpg, '.jpg?fk' + discuz_uid + '"');
            var restpng = new RegExp('.png"', "g");
            lur = lur.replace(restpng, '.png?fk' + discuz_uid + '"');
            var restgif = new RegExp('.gif"', "g");
            lur = lur.replace(restgif, '.gif?fk' + discuz_uid + '"');

            lur = lur.replace(rest, "'")
            lur = lur.replace(rest2, "'")

            jq('#scdm_html').val(lur);
            jq(".copy-tips").fadeOut(1000);
            closeWindowr(4);　　　　
            if (ipss == 0) {
                yulandaima('');
            }
            plstzclip();
        }
    })

}



//tyal模块ps


jq(document).ready(function () {
    jq('#texsyldmal').click(function () {
        tyscal(0);
    });
    jq('#texsscdmal').click(function () {
        tyscal(1);
    });
    jq('.fzsb').click(function () {
        jq('.fuzhi').hide();
        var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='gt'></i>请在以下编辑框中手动复制下哦。</div></div>");
        jq("body").find(".copy-tips").remove().end().append(copysuc);
        jq(".copy-tips").fadeOut(3000);

        //JS选中文本框中内容
        document.getElementById("scdm_html").focus();
        document.getElementById("scdm_html").select();
        //jquery选中文本框中内容
        jq("#scdm_html").focus();
        jq("#scdm_html").select();
    });


    jq('#zztexsyldmal').click(function () {
        daimazhuan(0);
    });
    jq('#zztexsscdmal').click(function () {
        daimazhuan(1);
    });


});



function daimazhuan(lx) {

    if (jq('textarea').is('#html_img') || jq('input').is('#html_img')) {
        if (!tycheck2()) {
            return false;
        }
    }


    jq('#scdm_html').val('');
    jq(".fuzhi").hide();
    jq("#texsfzdm").hide();
    jq(".zclip").hide();
    jq(".fzkcrdm").hide();

    var leixddd = htmlEncode(jq('#html_img').val());
    jq('#scdm_html').val(leixddd);

    　
    if (lx == 0) {
        yulandaima(leixddd);
    }
    plstzclip();
};




function tyscal(ipss) {

    if (jq('textarea').is('#html_img') || jq('input').is('#html_img')) {
        if (!tycheck2()) {
            return false;
        }
    } else {
        if (!tycheck()) {
            return false;
        }

    }

    jq('#scdm_html').val('');
    jq(".fuzhi").hide();
    jq("#texsfzdm").hide();
    jq(".zclip").hide();
    jq(".fzkcrdm").hide();


    　
    if (ipss == 0) {
        var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='dd'></i>预览代码生成中,请稍后...</div></div>");
        jq("body").find(".copy-tips").remove().end().append(copysuc);
    } else {
        var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='dd'></i>代码生成中,请稍后...</div></div>");
        jq("body").find(".copy-tips").remove().end().append(copysuc);
    }

    var formdata = jq('#shetsps').serialize()

    if (jq('label').is('#jrqpx')) {
        if (jq("#jiaruqp").get(0).checked) {

            formdata = formdata + "&jrqp=1";
        } else {
            formdata = formdata + "&jrqp=0";
        }
    }

    jq.ajax({
        type: 'post',
        url: "portal.php?mod=cs_post_gj&aid=" + aid + "&formhash=" + jq("#yformhash").html() + "&ajax=1", //拼接
        data: formdata,
        error: function () {
            alert('生成出错请检查您的设置');
        },
        success: function (html) {
            rs = eval("(" + html + ")");
            jq('#scdm_html').val('');

            var lur = rs['jieguo'];          
          
			if(lur == undefined){
				lur = rs['msg'];  
			}

			
			
            if (lur.indexOf("阿里巴巴工具VIP会员") >= 0) {
                //正则获取字符串里面的网址
                var durl = /[a-zA-z]+:\/\/[^\s]*/i;
                domain = lur.match(durl);
                zanzhu();
            };

            var rest5 = new RegExp("sttaig", "g");
            lur = lur.replace(rest5, 'stt' + discuz_uid + 'aig');


            var restjpg = new RegExp('.jpg"', "g");
            lur = lur.replace(restjpg, '.jpg?fk' + discuz_uid + '"');
            var restpng = new RegExp('.png"', "g");
            lur = lur.replace(restpng, '.png?fk' + discuz_uid + '"');
            var restgif = new RegExp('.gif"', "g");
            lur = lur.replace(restgif, '.gif?fk' + discuz_uid + '"');



            var yldm = lur;
    
            jq('#scdm_html').val(lur);
            jq(".copy-tips").fadeOut(1000);


            closeWindowr(4);　　　　
            if (ipss == 0) {
                yulandaima(yldm);
            }
            plstzclip();
        }
    })

}

//tyjd模块ps

jq(document).ready(function () {
    jq('#texsyldmjd').click(function () {
        tyscjd(0);
    });
    jq('#texsscdmjd').click(function () {
        tyscjd(1);
    });
    jq('.fzsb').click(function () {
        jq('.fuzhi').hide();
        var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='gt'></i>请在以下编辑框中手动复制下哦。</div></div>");
        jq("body").find(".copy-tips").remove().end().append(copysuc);
        jq(".copy-tips").fadeOut(3000);

        //JS选中文本框中内容
        document.getElementById("scdm_html").focus();
        document.getElementById("scdm_html").select();
        //jquery选中文本框中内容
        jq("#scdm_html").focus();
        jq("#scdm_html").select();
    });
});

function tyscjd(ipss) {

    if (jq('textarea').is('#html_img') || jq('input').is('#html_img')) {
        if (!tycheck2()) {
            return false;
        }
    } else {
        if (!tycheck()) {
            return false;
        }

    }
    jq('#scdm_html').val('');
    jq(".fuzhi").hide();
    jq("#texsfzdm").hide();
    jq(".zclip").hide();
    jq(".fzkcrdm").hide();


    　
    if (ipss == 0) {
        var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='dd'></i>预览代码生成中,请稍后...</div></div>");
        jq("body").find(".copy-tips").remove().end().append(copysuc);
    } else {
        var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='dd'></i>代码生成中,请稍后...</div></div>");
        jq("body").find(".copy-tips").remove().end().append(copysuc);
    }

    var formdata = jq('#shetsps').serialize()

    if (jq('label').is('#jrqpx')) {
        if (jq("#jiaruqp").get(0).checked) {

            formdata = formdata + "&jrqp=1";
        } else {
            formdata = formdata + "&jrqp=0";
        }
    }
    jq.ajax({
        type: 'post',
        url: "portal.php?mod=fktools_jd&aid=" + aid + "&formhash=" + jq("#yformhash").html() + "&ajax=1", //拼接
        data: formdata,
        error: function () {
            alert('生成出错请检查您的设置');
        },
        success: function (html) {
            rs = eval("(" + html + ")");
            jq('#scdm_html').val('');
            var rest2 = new RegExp("&quot;", "g");
            var lur = rs['jieguo'];
            lur = lur.replace(rest2, '"');
            var rest5 = new RegExp("sttaig", "g");
            lur = lur.replace(rest5, 'stt' + discuz_uid + 'aig');

            var restjpg = new RegExp('.jpg"', "g");
            lur = lur.replace(restjpg, '.jpg?fk' + discuz_uid + '"');
            var restpng = new RegExp('.png"', "g");
            lur = lur.replace(restpng, '.png?fk' + discuz_uid + '"');
            var restgif = new RegExp('.gif"', "g");
            lur = lur.replace(restgif, '.gif?fk' + discuz_uid + '"');


            jq('#scdm_html').val(lur);
            jq(".copy-tips").fadeOut(1000);
            closeWindowr(4);　　　　
            if (ipss == 0) {
                yulandaima(lur);
            }
            plstzclipall();

            jdewmshow();

        }
    })

}

function jdewmshow() {
    var xfcccc = jq('#scdm_html').val();
    if (jq('div').is('.ewmzs') && xfcccc.indexOf(".jd.com") > 0) {
        var cczhi = jq("#chicun").find("option:selected").text();
        var ewmdz = 'http://qr.liantu.com/api.php?w=' + cczhi.replace(/[^\d]/g, '') + '&m=0&text=' + xfcccc;
        jq("#mewm").attr('src', ewmdz);
    }
}




function tycheck() {
    var pics = jq("#picbox .control-group").length;
    for (var i = 1; i <= pics; i++) {
        var url = jq("#mkdm" + i).val();
        if (url == "" || url == "请在此处填写轮播内容") {
            jq("#mkdm" + i).focus();
            alert("注意：输入框 " + i + " 尚未填写！");
            return (false);
        } else {
            if (i == pics) {
                return (true);
            }
        }
    }

}





function tycheck2() {
    if (jq("#html_img").val() == "") {
        jq("#html_img").focus();
        alert("注意：模块代码还没有填写哦！");
        return (false);
    } else {
        return (true);
    }
}

//取图片尺寸填写
function psizei(obj, toid) {
    var sySrc = obj.value;
    if (IsURL(sySrc)) {
        jq("<img/>").attr("src", sySrc).load(function () {
            imgWidth = this.width;
            imgHeight = this.height;

            jq("#" + toid).css({
                "background-image": 'url("' + sySrc + '")',
                "width": imgWidth,
                "height": imgHeight
            });
        });
    }
}


//触控按钮/大图尺寸读写
function skpsize(obj, qlx) {
    var sySrc = obj.value;
    if (IsURL(sySrc)) {
        jq("<img/>").attr("src", sySrc).load(function () {
            imgWidth = this.width;
            imgHeight = this.height;

            if (qlx == 1) {
                var thisid = obj.name;
                var reg = /\d+/;
                var r = thisid.match(reg);
                jq("#anniu" + r).css({ //更新尺寸
                    "width": imgWidth,
                    "height": imgHeight
                });
                jq("#anniu" + r + " img").attr('src', sySrc);
                jq('[name="w[' + r + ']"]').val(imgWidth);
                jq('[name="h[' + r + ']"]').val(imgHeight);
            } else if (qlx == 2) {

                jq("#datu1").css({ //更新尺寸
                    "width": imgWidth,
                    "height": imgHeight
                });
                jq("#datu1 img").attr('src', sySrc);
                jq('[name="dtw"]').val(imgWidth);
                jq('[name="dth"]').val(imgHeight);
            } else if (qlx == 3) {
                jq("#datu1 img").attr('src', sySrc);

            } else if (qlx == 4) {

                jq("#zuojt").css({ //更新尺寸
                    "width": imgWidth,
                    "height": imgHeight
                });
                jq('[name="zjtk"]').val(imgWidth);
                jq('[name="zjtg"]').val(imgHeight);

                jq("#zuojt img").attr('src', sySrc);

            } else if (qlx == 5) {

                jq("#youjt").css({ //更新尺寸
                    "width": imgWidth,
                    "height": imgHeight
                });
                jq('[name="yjtk"]').val(imgWidth);
                jq('[name="yjtg"]').val(imgHeight);
                jq("#youjt img").attr('src', sySrc);

            }

        });
    }
}


function getzei(obj) {
    var sySrc = obj.value;
    if (IsURL(sySrc)) {
        jq("<img/>").attr("src", sySrc).load(function () {
            imgWidth = this.width;
            imgHeight = this.height;
            jq(".video" + obj.id).css({
                "height": imgHeight + "px",
                "width": imgWidth + "px"
            });
        });
    }
}

//触控对齐
function zjdq(obj, lx) {
    var mbid = jQuery(obj).attr('data-mkid');
    if (lx == 1) {
        var tyh = jQuery('#anniu' + mbid).css('top');
        for (var i = 0; i < jQuery('#picbox .control-group').length; i++) {
            jQuery('#anniu' + (i + 1)).css('top', tyh);
            jQuery('[name="y[' + (i + 1) + ']"]').val(tyh);
        }
    } else if (lx == 2) {
        var tyz = jQuery('#anniu' + mbid).css('left');
        for (var i = 0; i < jQuery('#picbox .control-group').length; i++) {
            jQuery('#anniu' + (i + 1)).css('left', tyz);
            jQuery('[name="x[' + (i + 1) + ']"]').val(tyz);
        }
    }
}


function htmlChange(toid) {
    var objS = document.getElementById("htmlxs"+toid);
    var grade = objS.options[objS.selectedIndex].value;
    if (grade == "none") {
        jQuery('.htmlquk'+toid).hide();
        jq("#htmldome"+toid).remove();
    } else {
        jQuery('.htmlquk'+toid).show();
        var htmlquk = '<span id="htmldome'+toid+'" class="htmlmk"  style="height: 320px; width: 500px; left: 434px; top: 81px; background: rgba(0, 255, 45, 0.14); position: absolute; border: 1px solid rgb(0, 255, 217);     overflow: hidden; cursor: move; z-index: 6;"><span class="htmlmkSmk" style="width: 100%;height: 100%;">请将代码换成你自己的代码</span></span>';
        jQuery("#dmspmk").append(htmlquk);

        jq('#dmspmk #htmldome'+toid).draggable({
            stop: function () {
                jq('[name="dmx['+toid+']"]').val(this.style.left);
                jq('[name="dmy['+toid+']"]').val(this.style.top);
            }
        });
        jq("#dmspmk #htmldome"+toid).resizable({
            containment: "parent",
            grid: 1,
            stop: function () {
                //alert(this.style.width);
                jq('[name="dmw['+toid+']"]').val(this.style.width);
                jq('[name="dmh['+toid+']"]').val(this.style.height);
            }
        });

        jQuery("#htmldaima"+toid).change(function () {
            jQuery("#htmldaima"+toid).val(zhuanyiut8(jQuery("#htmldaima"+toid).val()));
            jQuery('#htmldome'+toid+' .htmlmkSmk').html(jQuery("#htmldaima"+toid).val());
        });

    }
}


//plstzclip
function plstzclip() {
    var neyyss = jq('#scdm_html').val();
    if (neyyss.indexOf("&amp;gt;") > 0 || neyyss.indexOf("&gt;") > 0 || neyyss.indexOf(">") > 0 || neyyss.indexOf("amp;") > 0) {
        jq(".fuzhi").show();
        jq("#texsfzdm2").show();
        jq(".zclip").show();
        jq(".fzkcrdm").show();
        jq("#scdm_html").css({
            "font-size": "12px",
            "color": "#333",
            "text-align": "left",
            "line-height": "inherit"
        });

        jq('#texsfzdm2').zclip({
            path: "/static/ZeroClipboard.swf",
            copy: function () {
                if (jq('#scdm_html').val() == "") {
                    var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='cw'></i>请先生成代码再复制代码！</div></div>");
                    jq("body").find(".copy-tips").remove().end().append(copysuc);
                    jq(".copy-tips").fadeOut(3000);
                } else {

                    if (aid == 35) {
                        return jq('#scdm_html').val();
                    } else {
                        return jq('#scdm_html').val();
                    }

                }
            },
            afterCopy: function () {
                var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='cg'></i>复制成功</div></div>");
                jq("body").find(".copy-tips").remove().end().append(copysuc);
                jq(".copy-tips").fadeOut(3000);
            }
        });

        jq('.fzkcrdm').zclip({
            path: "/static/ZeroClipboard.swf",
            copy: function () {
                if (jq('#scdm_html').val() == "") {
                    var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='cw'></i>请先生成代码再复制代码！</div></div>");
                    jq("body").find(".copy-tips").remove().end().append(copysuc);
                    jq(".copy-tips").fadeOut(3000);
                } else {
                    var ybyt = htmlDecode(jq('#scdm_html').val());
                    ybyt = htmlDecode(ybyt);
                    ybyt = ybyt.replace(/\\u0020/g, "");
                    ybyt = ybyt.replace(/stylE/g, "style");
                    ybyt = ybyt.replace(/&amp;/g, "&");
                    return zhuanyiut8(ybyt);
                }
            },
            afterCopy: function () {
                var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='cg'></i>复制成功</div></div>");
                jq("body").find(".copy-tips").remove().end().append(copysuc);
                jq(".copy-tips").fadeOut(3000);
            }
        });

    } else {
        jq(".fzkcrdm").hide();
        jq(".fuzhi").hide();
        jq("#texsfzdm2").hide();
        jq(".zclip").hide();
        jq("#scdm_html").css({
            "font-size": "20px",
            "color": "#F00",
            "text-align": "center",
            "line-height": "30px"
        });
    }
}



 jQuery("#html_img").change(function () {
            jQuery("#html_img").val(zhuanyiut8(jQuery("#html_img").val()));
  });

jq('#clexsscdm').click(function(){
	jq('#scdm_html').empty();
	var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='dd'></i>代码生成中,请稍后...</div></div>");
	jq("body").find(".copy-tips").remove().end().append(copysuc);	
	var urldata = jq('#shetsps').serialize();
	
	if(urldata == ''){
		alert('请先填写相关内容再生成！');
		jq(".copy-tips").fadeOut(1000);
		return false
	}
	
	
	
	jq.ajax({
		type:'post',
		url:"portal.php?mod=cs_post_gj&aid="+ aid +"&formhash="+jq("#yformhash").html()+"&ajax=1",//拼接
		data:urldata,
		error:function(){
		  alert('生成出错请检查您的设置');
		},
		success:function(html){
    rs = eval("(" + html + ")");
            jq('#scdm_html').val('');

            var rest2 = new RegExp("&quot;", "g");
            var rest3 = new RegExp("alquot", "g");
            var rest4 = new RegExp("单引号", "g");
            var lur = rs['jieguo'];       

            if(lur.indexOf('&#')!=-1){
                 lur = htmlEncode(lur);
            }
            
            lur = lur.replace(rest2, '"');
            lur = lur.replace(rest4, "'");

            if (lur.indexOf("阿里巴巴工具VIP会员") >= 0) {
                //正则获取字符串里面的网址
                var durl = /[a-zA-z]+:\/\/[^\s]*/i;
                domain = lur.match(durl);
                zanzhu();
            };

            var rest5 = new RegExp("sttaig", "g");
            lur = lur.replace(rest5, 'stt' + discuz_uid + 'aig');


            var restjpg = new RegExp('.jpg"', "g");
            lur = lur.replace(restjpg, '.jpg?fk' + discuz_uid + '"');
            var restpng = new RegExp('.png"', "g");
            lur = lur.replace(restpng, '.png?fk' + discuz_uid + '"');
            var restgif = new RegExp('.gif"', "g");
            lur = lur.replace(restgif, '.gif?fk' + discuz_uid + '"');

            lur = lur.replace(rest3, "&quot;");
            jq('#scdm_html').val(lur);
            jq(".copy-tips").fadeOut(1000);


            closeWindowr(4);　　　　
         
            plstzclip();	
			}
	})

});




//plstzclipall
function plstzclipall() {
    var neyyss = jq('#scdm_html').val();
    if (neyyss.indexOf("&amp;gt;") > 0 || neyyss.indexOf("&gt;") > 0 || neyyss.indexOf(">") > 0 || neyyss.indexOf("amp;") > 0) {
        jq(".fuzhi").show();
        jq("#texsfzdm2").show();
        jq(".zclip").show();
        jq(".fzkcrdm").show();
        jq("#scdm_html").css({
            "font-size": "12px",
            "color": "#333",
            "text-align": "left",
            "line-height": "inherit"
        });

        jq('#texsfzdm2').zclip({
            path: "/static/ZeroClipboard.swf",
            copy: function () {
                if (jq('#scdm_html').val() == "") {
                    var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='cw'></i>请先生成代码再复制代码！</div></div>");
                    jq("body").find(".copy-tips").remove().end().append(copysuc);
                    jq(".copy-tips").fadeOut(3000);
                } else {
                    return jq('#scdm_html').val();
                }
            },
            afterCopy: function () {
                var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='cg'></i>复制成功</div></div>");
                jq("body").find(".copy-tips").remove().end().append(copysuc);
                jq(".copy-tips").fadeOut(3000);
            }
        });


    } else {
        jq(".fzkcrdm").hide();
        jq(".fuzhi").hide();
        jq("#texsfzdm2").hide();
        jq(".zclip").hide();
        jq("#scdm_html").css({
            "font-size": "20px",
            "color": "#F00",
            "text-align": "center",
            "line-height": "30px"
        });
    }
}

//临时调试

jq('#f_width').bind('input propertychange', function () {
    jq("#piaofu1").css({
        "width": jq("#f_width").val()
    });
});

jq('#f_height').bind('input propertychange', function () {
    jq("#piaofu1").css({
        "height": jq("#f_height").val()
    });
});

jq("#fudondm").change(function () {
    var gbner = jq('#fudondm').val();
    if (gbner.indexOf("&gt;") < 1 && gbner.indexOf("&amp;gt;") < 1) {
        jq('.htmlmkmk').html(jq('#fudondm').val());
    } else if (gbner.indexOf("&gt;") > 1) {
        jq('.htmlmkmk').html(htmlDecode(jq('#fudondm').val()));

    } else if (gbner.indexOf("&amp;gt;") > 1) {
        jq('.htmlmkmk').html(htmlDecode(htmlDecode(jq('#fudondm').val())));
    }
});

jq(".htmlmk").resize(function () {
    jq('#f_width').val(jq(".htmlmk").width());
    jq('#f_height').val(jq(".htmlmk").height());
});



jq('#show_widths').bind('input propertychange', function () {
    jq("#dmspmk").css({
        "width": jq("#show_widths").val()
    });
});

jq('#show_heights').bind('input propertychange', function () {
    jq("#dmspmk").css({
        "height": jq("#show_heights").val()
    });
});


jq('#show_width').bind('input propertychange', function () {
    jq("#dmspmk").css({
        "width": jq("#show_width").val()
    });

    if (jq("#show_width").val() > 952) {
        jq('#jiaruqps').attr('checked', 'checked');
    } else {
        jq('#jiaruqps').removeAttr('checked');
    }

});

jq('#show_height').bind('input propertychange', function () {
    jq("#dmspmk").css({
        "height": jq("#show_height").val()
    });
});




//js实现数组转换成json
function arrayToJson(o) {
    var r = [];
    if (typeof o == "string") return "\"" + o.replace(/([\'\"\\])/g, "\\$1").replace(/(\n)/g, "\\n").replace(/(\r)/g, "\\r").replace(/(\t)/g, "\\t") + "\"";
    if (typeof o == "object") {
        if (!o.sort) {
            for (var i in o)
                r.push(i + ":" + arrayToJson(o[i]));
            if (!!document.all && !/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(o.toString)) {
                r.push("toString:" + o.toString.toString());
            }
            r = "{" + r.join() + "}";
        } else {
            for (var i = 0; i < o.length; i++) {
                r.push(arrayToJson(o[i]));
            }
            r = "[" + r.join() + "]";
        }
        return r;
    }
    return o.toString();
}


//yuncun
var sjid = 0;
jq('#yunbf').click(function () {
    yuncunchu();
});

function yuncunchu() {

    if (jq('textarea').is('#html_img') || jq('input').is('#html_img') || jq('input').is('#mkbg')) {
        if (!tycheck2()) {
            return false;
        }
    } else {
        if (!tycheck()) {
            return false;
        }

    }

    var age = prompt("请输入备份数据名称(方便下次使用的时候查找):", toolsname + ' - 备份');
    if (age == null) {
        return false;
    }

    var formdata = jq('#shetsps').serialize()

    if (aid == 61) {
        var newboj = jq("#dmspmk").prop("outerHTML");

        /* 	newboj = newboj.replace(/ui-resizable/g,"");
        		newboj = newboj.replace(/ui-draggable/g,"");
        		newboj = newboj.replace(/ui-resizable-handle/g,"");
        		newboj = newboj.replace(/ui-resizable-s/g,"");
        		newboj = newboj.replace(/ui-icon-gripsmall-diagonal-se/g,"");
        		newboj = newboj.replace(/ui-icon/g,"");	 */

        var formdata = "[—_-|][|-o-]" + newboj;
    } else {
        var formdata = jq('#shetsps').serialize();
    }


    if (jq('label').is('#jrqpx')) {
        if (jq("#jiaruqp").get(0).checked) {
            formdata = formdata + "&jrqp=1";
        } else {
            formdata = formdata + "&jrqp=0";
        }
    }
    var rest = new RegExp("&", "g");
    var rest2 = new RegExp("=", "g");
    formdata = formdata.replace(rest, "[—_-|]")
    formdata = formdata.replace(rest2, "[|-o-]")

    jq.ajax({
        type: 'post',
        url: "portal.php?mod=beifen&aid=" + aid + "&formhash=" + jq("#yformhash").html() + "&lx=cun&ajax=1", //拼接
        data: "data=" + formdata + "&age=" + age,
        error: function () {
            alert('存储出错请检查您的设置');
        },
        success: function (html) {
            rs = eval("(" + html + ")");
            var lur = rs['jieguo'];

            if (rs['msm']) {
                var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='cg'></i>" + lur + "</div></div>");
                jq("body").find(".copy-tips").remove().end().append(copysuc);
                jq(".copy-tips").fadeOut(1000);
            } else {
                alert(lur);

            }　
        }
    })

}

var sjid = 0;

//yuncungai
jq('#yunfg').click(function () {
    yuncungai();
});

function yuncungai() {


    if (jq('textarea').is('#html_img') || jq('input').is('#html_img')) {
        if (!tycheck2()) {
            return false;
        }
    } else {
        if (!tycheck()) {
            return false;
        }

    }

    var formdata = jq('#shetsps').serialize()

    if (jq('label').is('#jrqpx')) {
        if (jq("#jiaruqp").get(0).checked) {
            formdata = formdata + "&jrqp=1";
        } else {
            formdata = formdata + "&jrqp=0";
        }
    }
    var rest = new RegExp("&", "g");
    var rest2 = new RegExp("=", "g");
    formdata = formdata.replace(rest, "[—_-|]")
    formdata = formdata.replace(rest2, "[|-o-]")
    jq.ajax({
        type: 'post',
        url: "portal.php?mod=beifen&aid=" + aid + "&formhash=" + jq("#yformhash").html() + "&lx=gai&ajax=1", //拼接
        data: "data=" + formdata + "&sjid=" + sjid + "&age=" + toolsname,
        error: function () {
            alert('覆盖出错请检查您的设置');
        },
        success: function (html) {
            rs = eval("(" + html + ")");
            var lur = rs['jieguo'];
            var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='cg'></i>" + lur + "</div></div>");
            jq("body").find(".copy-tips").remove().end().append(copysuc);
            jq(".copy-tips").fadeOut(1000);
        }
    })

}

//yuncundu
jq('#yundq').click(function () {
    yuncundu(sjid);
});

function yuncundu(sjids) {
    jq('.yundom').hide();
    var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='dd'></i>读取中，请稍后..</div></div>");
    jq("body").find(".copy-tips").remove().end().append(copysuc);
    sjid = sjids;
    jq.ajax({
        type: 'post',
        url: "portal.php?mod=beifen&aid=" + aid + "&formhash=" + jq("#yformhash").html() + "&lx=du&ajax=1", //拼接
        data: "sjid=" + sjids + "&data=[|-o-][—_-|]",
        error: function () {
            alert('读取出错请检查您的设置');
        },
        success: function (html) {
            rs = eval("(" + html + ")");
            var lur = rs['jieguo'];
            yuncunfx(lur);
            //	alert(lur);
            　
        }
    })
    jq(".copy-tips").fadeOut(3000);
}


//yuncunfx

function yuncunfx(ydata) {
    if (aid == 61) {
        ziyfx(ydata);
        return false;
    }

    str = ydata;
    var strs = new Array(); //定义一数组 
    strs = str.split("[—_-|]"); //字符分割 
    var yfg = new Array();
    for (i = 0; i < strs.length; i++) {
        yfg = strs[i].split("[|-o-]");
        //店铺类型处理
        if (yfg[0] == 'dplx' && jq('input').is('.dplx3')) {
            //alert(jq('[name="dplx"]').eq(3).val());
            jq('label.dplxla').removeClass('checked');
            jq('input[name="dplx"]').removeAttr('checked');
            jq('#dplx label').eq(yfg[1]).attr('class', 'dplxla checked');
            jq('[name="dplx"]').eq(yfg[1]).attr('checked', 'checked');
        }

        if (yfg[0] == 'jrqp' && yfg[1] == 1) { //是否加入全屏
            jq('label#jrqpx').attr('class', 'jrqpdaim');
            jq('#jiaruqp').attr('checked', 'checked');
        } else if (jq('label').is('#jrqpx')) {
            jq('label#jrqpx').attr('class', 'checked');
            jq('#jiaruqp').removeAttr('checked');
        }

        if (yfg[0] == 'donghua' || yfg[0] == 'opentype') {
            jq('[value="' + yfg[1] + '"]').attr('checked', 'checked');
        } else if (yfg[0] != 'dplx' && yfg[0] != 'jrqp' && jq('select').is('[name="' + yfg[0] + '"]') == false) {

            if (jq('input,select,textarea').is('[name="' + yfg[0] + '"]') == false) {
               addpic();
            }
            if (yfg[0].indexOf('wwnc') != -1 && jq('input,select,textarea').is('[name="' + yfg[0] + '"]') == false) {
                addpics();
            }

            jq('[name="' + yfg[0] + '"]').val(zhuanyiut8(yfg[1]));

        } else if (jq('select').is('[name="' + yfg[0] + '"]') != false) {
            //组合框读取 
            jQuery('[name="' + yfg[0] + '"]  option[value="' + yfg[1] + '"]').attr("selected", true);
        }

        jq(".bkan .fgbf").css({
            "display": "block"
        });
        jq(".bkan .lcsj a").html('当前操作记录另存为');
    }

    yunguiwei();

}

//yuncundulist

jq('#yundqlist').click(function () {
    if (jq(".hovertable tr").length < 2) {
        var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='dd'></i>云端数据读取中..</div></div>");
        jq("body").find(".copy-tips").remove().end().append(copysuc);
        yuncundulist();
    } else if (jq(".hovertable tr").length > 1) {
        jq('.yundom').show();
    }
});
jq('.bkan #select.sj_bf_btn').click(function () {
    if (jq(".hovertable tr").length < 2) {
        var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='dd'></i>云端数据读取中..</div></div>");
        jq("body").find(".copy-tips").remove().end().append(copysuc);
        yuncundulist();
    } else if (jq(".hovertable tr").length > 1) {
        jq('.yundom').show();
    }
});

jq('.bkandh #select.sj_bf_btn').click(function () {
    window.open("https://work.1688.com/");
});

function yuncundulist() {
    jq.ajax({
        type: 'post',
        url: "portal.php?mod=beifen&formhash=" + jq("#yformhash").html() + "&lx=dulist&ajax=1", //拼接
        data: "aid=" + aid + "&data=[|-o-][—_-|]",
        error: function () {
            alert('读取出错请检查您的设置');
        },
        success: function (html) {
            rs = eval("(" + html + ")");
            for (i = 0; i < rs.length - 1; i++) {
                var newpic = "<tr  class=\"tms" + i + "\" onmouseover=\"this.style.backgroundColor='#545454';\" onmouseout=\"this.style.backgroundColor='#7B7B7B';\">	<td class=\"xh\">" + (i + 1) + "</td><td  id=\"bfname\"><span>" + rs[i]['bftiele'] + "</span></td><td>" + getLocalTime(rs[i]['bfimes']) + "</td><td><button  name=\"tms" + i + "\" value=\"" + rs[i]['sjid'] + "\" class=\"bfdr\"  type=\"button\">导入备份</button></td><td><button  name=\"tms" + i + "\"  value=\"" + rs[i]['sjid'] + "\" class=\"bfdel\"  type=\"button\">删除备份</button></td></tr>";
                jq(".hovertable tbody").append(newpic);
                //
            }
            if (jq(".hovertable tr").length > 1) {
                jq('.yundom').show();
                jq(".yundom .nls").remove();

                jq('.hovertable .bfdr').click(function () {
                    yuncundu(jq(this).val());
                    toolsname = jq('.' + this.name + " span").html();
                });

                jq('.hovertable .bfdel').click(function () {
                    yuncundel(jq(this).val(), this.name);
                });
            } else {
                jq(".copy-tips").fadeOut(1000);
                var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='cw'></i>未发现操作备份..</div></div>");
                jq("body").find(".copy-tips").remove().end().append(copysuc);
                jq(".copy-tips").fadeOut(3000);

            }
        }
    })
    jq(".copy-tips").fadeOut(3000);
}

jq('.yundom .gb').click(function () {
    jq('.yundom').hide();
});

function yuncundel(sjids, name) {
    jq.ajax({
        type: 'post',
        url: "portal.php?mod=beifen&aid=" + aid + "&formhash=" + jq("#yformhash").html() + "&lx=del&ajax=1", //拼接
        data: "sjid=" + sjids + "&data=[|-o-][—_-|]",
        error: function () {
            alert('读取出错请检查您的设置');
        },
        success: function (html) {
            rs = eval("(" + html + ")");
            var lur = rs['jieguo'];
            jq(".yundom ." + name).remove();
            if (jq(".hovertable tr").length < 2) {
                jq('.yundom').hide();
            }
        }
    })
}




jq(function () {
    jq('label.dplxla').click(function () {
        var radioId = jq(this).attr('for');
        jq('label.dplxla').removeClass('checked') && jq(this).attr('class', 'dplxla checked');
        jq('input[name="dplx"]').removeAttr('checked') && jq('.dplx' + radioId).attr('checked', 'checked');
    });
});


jq('label#jrqpx').click(function () {
    if (jq("#jiaruqp").get(0).checked) {
        jq('label#jrqpx').attr('class', 'jrqpdaim');
    } else {
        jq('label#jrqpx').attr('class', 'checked');
    }
});


function fktimeshow() {
    var mydate = new Date();
    var str = "" + mydate.getFullYear() + "年";
    str += (mydate.getMonth() + 1) + "月";
    str += mydate.getDate() + "日";
    str += mydate.getHours() + "时";
    str += mydate.getMinutes() + "分";
    return str;
}



function getLocalTime(nS) {
    return new Date(parseInt(nS) * 1000).toLocaleString().replace(/:\d{1,2}$/, ' ');
}


jq(function () {

    jq("#rerun")
        .button()
        .click(function () {
            menu.hide();
        })
        .next()
        .button({
            text: false,
            icons: {
                primary: "ui-icon-triangle-1-s"
            }
        })
        .mouseover(function () {
            var menu = jq(this).parent().next().show().position({
                my: "left top",
                at: "left bottom",
                of: this
            });
            jq(document).one("click", function () {
                menu.hide();
            });
            return false;
        })
        .parent()
        .buttonset()
        .next()
        .hide()
        .menu();
});

jq(function () {

    jq("#kjdh")
        .button()
        .click(function () {
            menu.hide();
        })
        .next()
        .button({
            text: false,
            icons: {
                primary: "ui-icon-triangle-1-s"
            }
        })
        .mouseover(function () {
            var menu = jq(this).parent().next().show().position({
                my: "left top",
                at: "left bottom",
                of: this
            });
            jq(document).one("click", function () {
                menu.hide();
            });
            return false;
        })
        .parent()
        .buttonset()
        .next()
        .hide()
        .menu();
});

jq(function () {
    jq('#shetsps').tooltip({
        position: {
            my: "center bottom-20",
            at: "center top",
            using: function (position, feedback) {
                jq(this).css(position);
                jq("<div>")
                    .addClass("arrow")
                    .addClass(feedback.vertical)
                    .addClass(feedback.horizontal)
                    .appendTo(this);
            }
        }
    });
});



//zzzz

function tianjian(na) {
    if (na == 'wwzj') {
        addjww();
    } else if (na == 'requ') {
        addrq();
    }


    jq(function () {
        jq(".zpops").draggable()
    });
}

var nmww = 1;

function addjww() {
    nmww = nmww + 1;
    var newww = '<span class="zpops ww" name="alww" id="ww' + nmww + '" style="width: 77px; height: 19px;position: absolute;top: 12px; left: 499px; cursor: move;;background: url(http://wwimgsrc.cn-hangzhou.oss-pub.aliyun-inc.com/htdocs/im/actions/wbtx/alitalk/10/online.gif) no-repeat;" data-param="{&quot;wwid&quot;:&quot;' + tywwid + '&quot;,&quot;style&quot;:10,&quot;title&quot;:&quot;点击联系我&quot;}"></span>';
    jq('#dmspmk').append(newww);
    getObjdata(jq("#ww" + nmww));
    jq("#dialog-con").dialog("open");
    jq("#dialog-requ").dialog("close");
}

var nmrq = 0;

function addrq() {
    nmrq = nmrq + 1;
    var newrq = '<span  class="zpops rq rez"  name="requ"  id="rq' + nmrq + '" style="width:165px; height:75px;position: absolute;top: 12px; left: 499px; cursor: move;opacity: 0.5;background: rgb(0, 230, 255);" data-param="{&quot;aurl&quot;:&quot;&quot;,&quot;style&quot;:&quot;_blank&quot;}"></span>';
    jq('#dmspmk').append(newrq);
    jq("#dmspmk .rez").resizable();
    getObjdata(jq("#rq" + nmrq));
    jq("#dialog-con").dialog("close");
    jq("#dialog-requ").dialog("open");

}

jq('.popzjmb li').live({
    click: function () {
        tianjian(this.id);
    }
});



jq('.zpops').live({
    dblclick: function () { //双击	
        dcike(this);
    },
    mousedown: function () { //单击	
        dcike(this);
    },
    mouseenter: function () { //鼠标经过
        jq(this).append("<div class='plst'><div class='aniu delniu' title='删除此组件'>×</div></div>");
    },
    mouseleave: function () { //鼠标移开
        jq('.plst').remove();
    }
});

function dcike(zjcko) {
    var manes = jq(zjcko).attr("name");
    if (manes == "alww") {
        jq("#dialog-con").dialog("open");
        jq("#dialog-requ").dialog("close");
        getObjdata(jq(zjcko));

    } else if (manes == "requ") {
        jq("#dialog-requ").dialog("open");
        jq("#dialog-con").dialog("close");
        getObjdata(jq(zjcko));

    }


}

jq('.delniu').live({
    click: function () {
        zjd = jq(this).parent().parent();

        zjd.remove();
        jq('#shuxin').fadeOut();
        jq("#dialog-con").dialog("close");
        jq("#dialog-requ").dialog("close");
    }
});

jq('.addniu').live({
    click: function () {
        zjd = jq(this).parent().parent();

        var newboj = jq(zjd).prop("outerHTML");

        jq('#dmspmk').append(jq(newboj).clone(true))

        alert(newboj);

    }
});


function getObjdata(bjzu) {
    var jsdata = bjzu.attr('data-param');
    if (typeof jsdata != 'undefined') {
        JSONdata = jQuery.parseJSON(jsdata);
        jq("#wwid").val(JSONdata['wwid']);
        jq('input[name="style"][value="' + JSONdata['style'] + '"]').attr('checked', 'checked');
        jq("#title").val(JSONdata['title']);
        jq("#zjid").html(bjzu.attr('id'));

        jq("#rqurl").val(JSONdata['aurl']);
    }
}

//绑定事件
jq(document).ready(function () {
    /* jq(".input-box").change(function(){
    baosww();
    }); */

    jq('.input-box').bind('input propertychange', function () {
        if (this.id == "mkbg") {
            psize(this, 1);
        } else {
            baosww();
        }

    });

    jq('input[type=radio][name=style]').change(function () {
        baosww();
    });

    jq('#suodin').click(function () {
        if (jq("#suodin").get(0).checked) {
            jq('#dmspmk').css({
                "background-attachment": "fixed"
            });
        } else {
            jq('#dmspmk').css({
                "background-attachment": "inherit"
            });
        }
    });

    jq('#pinpu').click(function () {
        if (jq("#pinpu").get(0).checked) {
            jq('#dmspmk').css({
                "background-repeat": "repeat"
            });
        } else {
            jq('#dmspmk').css({
                "background-repeat": "no-repeat"
            });
        }
    });

    jq('#juzhon').click(function () {
        if (jq("#juzhon").get(0).checked) {
            jq('#dmspmk').css({
                "background-position": "center center"
            });
        } else {
            jq('#dmspmk').css({
                "background-position": "left top"
            });
        }
    });

    jq('#mkwyc').click(function () {
        if (jq("#mkwyc").get(0).checked) {
            jq('#dmspmk').css({
                "overflow": "hidden"
            });
        } else {
            jq('#dmspmk').css({
                "overflow": "visible"
            });
        }
    });


    jq('#texssczydm').click(function () {
        sczydm(1);
    });

    jq('#texsylzydm').click(function () {
        sczydm(0);
    });

});


function sczydm(ipss) {
    if (jq("#show_width").val() < 1 || jq("#show_height").val() < 1) {
        alert("请在右侧全局设置面板中，填写模块宽度高度！");
        return false;
    }
    if (ipss == 0) {
        var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='dd'></i>预览代码生成中,请稍后...</div></div>");
        jq("body").find(".copy-tips").remove().end().append(copysuc);
    } else {
        var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='dd'></i>代码生成中,请稍后...</div></div>");
        jq("body").find(".copy-tips").remove().end().append(copysuc);
    }


    jq.ajax({
        type: 'post',
        url: "portal.php?mod=cs_post_gj&aid=" + aid + "&formhash=" + jq("#yformhash").html() + "&ajax=1", //拼接
        data: GetmkCode(),
        error: function () {
            alert('生成出错请检查您的设置');
        },
        success: function (html) {
            rs = eval("(" + html + ")");
            jq('#code').val('');

            var rest2 = new RegExp("&quot;", "g");
            var rest3 = new RegExp("alquot", "g");
            var rest4 = new RegExp("单引号", "g");

            var lur = rs['jieguo'];
            if (jq('div').is('.dmclq')) {} else {
                lur = htmlEncode(lur);
            }

            lur = lur.replace(rest2, '"');
            lur = lur.replace(rest4, "'");
            var rest5 = new RegExp("sttaig", "g");
            lur = lur.replace(rest5, 'stt' + discuz_uid + 'aig');

            var restjpg = new RegExp('.jpg"', "g");
            lur = lur.replace(restjpg, '.jpg?fk' + discuz_uid + '"');
            var restpng = new RegExp('.png"', "g");
            lur = lur.replace(restpng, '.png?fk' + discuz_uid + '"');
            var restgif = new RegExp('.gif"', "g");
            lur = lur.replace(restgif, '.gif?fk' + discuz_uid + '"');


            var yldm = lur;
            lur = lur.replace(rest3, "&quot;");
            jq('#code').val(lur);
            jq(".copy-tips").fadeOut(1000);
            jq("#zyscdm").dialog("open");　　　
            if (ipss == 0) {
                yulandaimazy(yldm);
            }
            zyplstzclip();
        }
    })

}



function GetmkCode() {
    var qp = 0;
    if (jq("#jiaruqps").get(0).checked) {
        qp = 1;
    } else {
        qp = 0;
    }

    var main = {
        zjName: 'main',
        style: jq('#dmspmk').attr('style'),
        width: jq('#dmspmk').width(),
        height: jq('#dmspmk').height(),
        xs: jq('#xiaoshang').val(),
        xx: jq('#xiaoxia').val(),
        jrqp: qp
    };
    var lsss = [];
    var jsss = [];
    var zzs = jq('#dmspmk').children('span').length;

    for (var i = 0; i < zzs; i++) {
        lsss[i] = {
            zjName: jq('#dmspmk span').eq(i).attr('name'),
            //style: jq('#dmspmk span').eq(i).attr('style'),
            top: jq('#dmspmk span').eq(i).css('top'),
            left: jq('#dmspmk span').eq(i).css('left'),
            backgroundimg: jq('#dmspmk span').eq(i).css('background-image'),
            backgroundrep: jq('#dmspmk span').eq(i).css('background-repeat'),
            backgroundzz: jq('#dmspmk span').eq(i).css('background-position'),
            backgroundcl: jq('#dmspmk span').eq(i).css('background-color'),
            width: jq('#dmspmk span').eq(i).width(),
            height: jq('#dmspmk span').eq(i).height(),
            jonssj: jq('#dmspmk span').eq(i).attr('data-param')
        };

    }

    var st = {
        main: main,
        data: lsss,
    };

    return st;
}

function baosww() {
    tywwid = jq("#wwid").val();

    var wwstyle = jq('input:radio[name="style"]:checked').val();
    jq('#' + jq("#zjid").html()).attr('data-param', '{"wwid":"' + jq("#wwid").val() + '","style":"' + wwstyle + '","title":"' + jq("#title").val() + '","aurl":"' + jq("#rqurl").val() + '"}');

    if (wwstyle == 10) {
        jq('#' + jq("#zjid").html()).css({
            "background": 'url("https://wwimgsrc.cn-hangzhou.oss-pub.aliyun-inc.com/htdocs/im/actions/wbtx/alitalk/10/online.gif") no-repeat 0px 0px',
            "width": '77',
            "height": '19'
        });
    } else if (wwstyle == 11) {
        jq('#' + jq("#zjid").html()).css({
            "background": 'url("https://wwimgsrc.cn-hangzhou.oss-pub.aliyun-inc.com/htdocs/im/actions/wbtx/alitalk/11/online.gif") no-repeat 0px 0px',
            "width": "22",
            "height": "22"
        });
    } else if (wwstyle == 12) {
        jq('#' + jq("#zjid").html()).css({
            "background": 'url("https://wwimgsrc.cn-hangzhou.oss-pub.aliyun-inc.com/htdocs/im/actions/wbtx/alitalk/12/online.gif") no-repeat -14px 0px',
            "width": "30",
            "height": "30"
        });
    } else if (wwstyle == 1) {
        jq('#' + jq("#zjid").html()).css({
            "background": 'url("https://wwimgsrc.cn-hangzhou.oss-pub.aliyun-inc.com/htdocs/im/actions/wbtx/alitalk/1/online.gif") no-repeat 0px 0px',
            "width": '77',
            "height": '19'
        });
    }
}

//属性面板
jq(function () {
    jq("#dialog-zjmb").draggable()
});

var tywwid = "";
var cisk = (window.innerWidth - 275);

jq(function () {
    jq("#dialog-qjsz").dialog({
        autoOpen: true,
        width: 255,
        position: [cisk, 90],
        resizable: false,
        dialogClass: 'sxmb',
        //modal: true,

        show: {
            effect: "blind",
            duration: 1000
        },
        hide: {
            effect: "explode",
            duration: 1000
        },
        open: function (event, ui) {
            jq(".ui-dialog-titlebar-close", jq(this).parent()).hide();
        }
    });

});

jq(function () {
    jq("#dialog-con").dialog({
        autoOpen: false,
        width: 255,
        position: [cisk, jq('[aria-describedby="dialog-qjsz"]').outerHeight() + 92],
        resizable: false,
        dialogClass: 'sxmb',
        //modal: true,

        show: {
            effect: "blind",
            duration: 1000
        },
        hide: {
            effect: "explode",
            duration: 1000
        }
    });

});

jq(function () {
    jq("#dialog-requ").dialog({
        autoOpen: false,
        width: 255,
        position: [cisk, jq('[aria-describedby="dialog-qjsz"]').outerHeight() + 92],
        resizable: false,
        dialogClass: 'sxmb',
        //modal: true,

        show: {
            effect: "blind",
            duration: 1000
        },
        hide: {
            effect: "explode",
            duration: 1000
        }
    });

});

jq(function () {
    jq("#zyscdm").dialog({
        autoOpen: false,
        width: 800,
        height: 420,
        // resizable: false,
        dialogClass: 'dmcope',
        modal: true,

        show: {
            effect: "blind",
            duration: 1000
        },
        hide: {
            effect: "explode",
            duration: 1000
        }
    });

});

jq(window).resize(function () {
    cisk = (window.innerWidth - 275);
    jq('.sxmb').css({
        'left': cisk + 'px'
    });
    jq('#cdmkssss').css({
        "height": window.innerHeight - 5
    });
});







function yulandaimazy(reszi) {
    var neyyss = jq('#code').val();
    if (neyyss.indexOf("&amp;gt;") < 1 && neyyss.indexOf("&gt;") < 0 && neyyss.indexOf(">") < 0) {
        return false;
    }

    if (jq('#code').val() == "") {
        var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'>请先生成代码再预览效果！</div></div>");
        jq("body").find(".copy-tips").remove().end().append(copysuc);
        jq(".copy-tips").fadeOut(3000);
        return false
    }
    var postdta = "";
    if (reszi != "") {
        postdta = reszi;
    } else {
        postdta = jq('#code').val();
    }

    jq.post("/static/yulandaima/yulan.php", {
            leix: 4,
            data: htmlDecode(postdta),
        },
        function (data, status) {
            var yldm = htmlDecode(data);
            var rest2 = new RegExp("alquot", "g");
            yldm = yldm.replace(rest2, "&quot;");

            var copysuc = jq("<div class='copy-yltips'><div class='copy-yltips-wrap'><input type='button' value='预览窗口打开失败,请点击此按钮预览效果！' name='sddkyl' id='sddkyl' class='btn-ok'><a href='http://www.mgzxzs.com/tmtbzxjc/644.html' class='szblj'  target='_blank'>设置预览窗口不被拦截的方法</a></div></div>");
            jq("body").find(".copy-yltips").remove().end().append(copysuc);

            jq('.copy-yltips #sddkyl').click(function () {
                mytools.webdebugger.Webtest(yldm);
                jq(".copy-yltips").fadeOut(2);
            });
            jq('.copy-yltips a').click(function () {
                jq(".copy-yltips").fadeOut(2);
            });

            mytools.webdebugger.Webtest(yldm);
            jq(".copy-yltips").fadeOut(2);

        });
};







function zyplstzclip() {

    jq('#copyCode').zclip({
        path: "/static/ZeroClipboard.swf",
        copy: function () {
            if (jq('#code').val() == "") {
                var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='cw'></i>请先生成代码再复制代码！</div></div>");
                jq("body").find(".copy-tips").remove().end().append(copysuc);
                jq(".copy-tips").fadeOut(3000);
            } else {
                return jq('#code').val();
            }
        },
        afterCopy: function () {
            var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='cg'></i>复制成功</div></div>");
            jq("body").find(".copy-tips").remove().end().append(copysuc);
            jq(".copy-tips").fadeOut(3000);
        }
    });

    jq('.fzkcrdm').zclip({
        path: "/static/ZeroClipboard.swf",
        copy: function () {
            if (jq('#code').val() == "") {
                var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='cw'></i>请先生成代码再复制代码！</div></div>");
                jq("body").find(".copy-tips").remove().end().append(copysuc);
                jq(".copy-tips").fadeOut(3000);
            } else {
                return zhuanyiut8(htmlDecode(jq('#code').val()));
            }
        },
        afterCopy: function () {
            var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='cg'></i>复制成功</div></div>");
            jq("body").find(".copy-tips").remove().end().append(copysuc);
            jq(".copy-tips").fadeOut(3000);
        }
    });

}

function hfhtmk(obj) {
    jQuery(obj).val(zhuanyiut8(jQuery(obj).val()));
}


function zhuanyiut8(atata) {
    var jieguo = htmlDecode(atata);

    jieguo = jieguo.replace(/\\u0020/g, "");
    jieguo = jieguo.replace(/stylE/g, "style");
    jieguo = jieguo.replace(/&amp;/g, "&");
    jieguo = jieguo.replace(/&amp;/g, "&");
    jieguo = jieguo.replace(/&amp;#60;/g, '<');
    jieguo = jieguo.replace(/&amp;#62;/g, '>');
    jieguo = jieguo.replace(/&amp;#61;/g, '=');
    jieguo = jieguo.replace(/&amp;#99;&amp;#108;&amp;#97;&amp;#115;&amp;#115;/g, 'class');
    jieguo = jieguo.replace(/&amp;#115;&amp;#116;&amp;#121;&amp;#108;&amp;#101;/g, 'style');
    jieguo = jieguo.replace(/&amp;#115;&amp;#116;&amp;#121;&amp;#108;&amp;#69;/g, 'stylE');
    jieguo = jieguo.replace(/&amp;#60;/g, '<');
    jieguo = jieguo.replace(/&amp;#62;/g, '>');
    jieguo = jieguo.replace(/&amp;quot;/g, '"');
    jieguo = jieguo.replace(/pre/g, 'div');
    jieguo = jieguo.replace(/white-space: inherit;/g, '');
    jieguo = jieguo.replace(/white-space:inherit;/g, '');
    jieguo = jieguo.replace(/&quot;/g, '"');
    jieguo = jieguo.replace(/&#60;/g, '<');
    jieguo = jieguo.replace(/&#62;/g, '>');
    jieguo = jieguo.replace(/&#61;/g, '=');
    jieguo = jieguo.replace(/&#99;&#108;&#97;&#115;&#115;/g, 'class');
    jieguo = jieguo.replace(/&#115;&#116;&#121;&#108;&#101;/g, 'style');
    jieguo = jieguo.replace(/&#115;&#116;&#121;&#108;&#69;/g, 'stylE');
    jieguo = jieguo.replace(/&#60;/g, '<');
    jieguo = jieguo.replace(/&#62;/g, '>');
    jieguo = htmlDecode(jieguo);
    return jieguo;
}

function dmkhtml(obj, lx) {
    var jiegma = zhuanyiut8(jq(obj).val());
    jq(obj).val(jiegma);
    if (lx == 1) {
        var zhanshima = jiegma.replace(/href/g, 'd-href');
        zhanshima = zhanshima.replace(/target/g, 'd-target');
        jQuery('#datu1 .htmlmkSmk').html(zhanshima);

    }
}






function ziyfx(ydata) {
    var daaa = ydata;
    var ydatas = daaa.replace(/\[\—\_\-\|\]/g, '"');
    ydatas = ydatas.replace(/\[\|\-\o\-\]/g, "=");
    ydatas = ydatas.replace(/\"\=/, "");
    var rest2 = new RegExp("&quot;", "g");
    ydatas = ydatas.replace(rest2, '"');



    /* var rest2 = new RegExp("&quot;","g");	
    ydatas = ydatas.replace(rest2,'"');	
    rs=eval("("+ydatas+")");	 */

    //alert(rs['data'][1]["zjName"]);
    ydatas = htmlDecode(ydatas);
    ydatas = ydatas.replace(/\"quot\;/g, "&quot;");

    ydatas = ydatas.replace(/ui-resizable/g, "");
    ydatas = ydatas.replace(/ui-icon-gripsmall-diagonal-se/g, "");
    ydatas = ydatas.replace(/ui-resizable-handle/g, "");
    ydatas = ydatas.replace(/ui-resizable-se/g, "");
    ydatas = ydatas.replace(/ui-draggable/g, "");

    ydatas = ydatas.replace(/ui-resizable-s/g, "");

    ydatas = ydatas.replace(/ui-icon/g, "");



    jq('#dmspmk').remove();

    jq('.democao').append(ydatas);

    jq(function () {
        jq(".zpops").draggable();
    });

    jq("#dmspmk .rez").resizable();
}



jq.getScript('/static/js/jquery-1.8.4.min.js');