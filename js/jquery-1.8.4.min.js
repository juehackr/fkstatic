jq(document).ready(function () {
	//取宝贝基础信息
	jq('#picbox input').bind('input propertychange', function () {
		if (isbb(this) == false) {
			return false
		}
		var regs = new RegExp("(\/|\id\=)[1-9][0-9]{5,}");
		var urlss = this.value;

		var rsss = urlss.match(regs);
		var picsl = jq("#picbox .control-group").length;
		var thisid = jQuery(this).attr('name');
		var reg = /\d+/;
		var rjg = thisid.match(reg);
		if ((rsss != "" || urlss.indexOf('product') != -1 || urlss.indexOf('p-detail') != -1) && yaoti != 88) {	//88代表不需要提取		
			duitme(rjg, rsss, urlss);
		}
	});
});



function dqplsd() {
	jq('#picbox input').bind('input propertychange', function () {
		if (isbb(this) == false) {
			return false
		}
		var regs = new RegExp("(\/|\id\=)[1-9][0-9]{5,}");
		var urlss = this.value;
		var rsss = urlss.match(regs);
		var picsl = jq("#picbox .control-group").length;
		var thisid = jQuery(this).attr('name');
		var reg = /\d+/;
		var rjg = thisid.match(reg);
		if ((rsss != "" || urlss.indexOf('product') != -1 || urlss.indexOf('p-detail') != -1) && yaoti != 88) {
			duitme(rjg, rsss, urlss);
		}
	});
}


function dudplxss(dpurl) {
	var dplxs = '';

	if (dpurl.indexOf('.1688.') != -1) {
		dplxs = '1688';
	} else if (dpurl.indexOf('taobao.') != -1 || dpurl.indexOf('tmall.') != -1 || dpurl.indexOf('jiyoujia.') != -1 || dpurl.indexOf('fliggy.') != -1) {
		dplxs = 'tbtm';
	} else if (dpurl.indexOf('jd.') != -1) {
		dplxs = 'jd';
	} else if (dpurl.indexOf('alibaba') != -1) {
		dplxs = 'alibaba';
	}
	return dplxs;
}

function isbb(objs) {
	var cxurl = objs.value;
	if (cxurl.indexOf('item.') != -1 || cxurl.indexOf('detail.') != -1 || cxurl.indexOf('product') != -1 || cxurl.indexOf('p-detail') != -1) {
		return true;
	} else {
		return false;
	}
}

function duitme(opsid, itmeid, dpurls) {
	var copysuc = jq("<div class='copy-tips'><div class='copy-tips-wrap'><i class='dd'></i>宝贝信息读取中..</div></div>");
	jq("body").find(".copy-tips").remove().end().append(copysuc);

	jq.ajax({
		type: 'post',
		url: "/fkapi/fkitme.php",
		data: "itmeid=" + itmeid + "&run=" + dudplxss(dpurls) + '&url=' + dpurls,
		error: function () {
			jq(".copy-tips").fadeOut(1000);
			alert('因对方服务不稳定,本次提取失败,请手动填写一下相关信息！');
		},
		success: function (html) {
			rs = eval("(" + html + ")");
			jq('[name="pic[' + opsid + ']"]').val(rs['zhutu']);
			jq('[name="biaoti[' + opsid + ']"]').val(rs['title']);
			jq('[name="xianjia[' + opsid + ']"]').val(rs['jiege']);
			jq('[name="yuanjia[' + opsid + ']"]').val(rs['jiege']);
			jq('[name="cuxiaojia[' + opsid + ']"]').val(rs['jiege']);
			jq('[name="jiage[' + opsid + ']"]').val(rs['jiege']);
			if (rs['xiaoliang'] != '') {
				jq('[name="xiaoliang[' + opsid + ']"]').val(rs['xiaoliang']);
			}
		}
	})
	jq(".copy-tips").fadeOut(3000);
};
jq('[name="bjfstp"]').click(function () {
	jq("#dmspmk").css({ 'background-attachment': this.value });
});

if (aid == 84) {
	jq('#sskci').bind('input propertychange', function () {
		jq("#input").html(this.value);
	});
	jq('#yanse').bind('input propertychange', function () {
		jq("#input").css({ 'color': this.value });
	});

	jq('#zihao').bind('input propertychange', function () {
		jq("#input").css({ 'font-size': this.value + "px" });
	});

}


jQuery('.editPanel .tab .nav.clear-fix li').click(function () {
	jQuery('.editPanel .tab .nav.clear-fix li').removeAttr('class'), jQuery('.editPanel .tab .nav.clear-fix li').attr('tabindex', '-1') && jQuery(this).attr('class', 'first selected'), jQuery(this).attr('tabindex', '0');
	jQuery('.panels .panel.item-set').hide();
	jQuery('.panels .panel.item-set').attr('aria-hidden', 'true');
	jQuery('.panels .panel.item-set').attr('class', 'panel display-set hidden');

	jQuery('[aria-labelledby="' + this.id + '"]').attr('class', 'panel item-set');
	jQuery('[aria-labelledby="' + this.id + '"]').attr('aria-hidden', 'false');
	jQuery('[aria-labelledby="' + this.id + '"]').show();
});
jQuery('.items-set.opened .title.J_itemSetTrigger').click(function () {
	jQuery(this).parent().attr('class') == 'items-set opened' ? jQuery(this).parent().attr('class', 'items-set opened closed') : jQuery(this).parent().attr('class', 'items-set opened');
});

function urldecode(str, charset, callback) {
	window._urlDecodeFn_ = callback;
	var script = document.createElement('script');
	script.id = '_urlDecodeFn_';
	var src = 'data:text/javascript;charset=' + charset + ',_urlDecodeFn_("' + str + '");'
	src += 'document.getElementById("_urlDecodeFn_").parentNode.removeChild(document.getElementById("_urlDecodeFn_"));';
	script.src = src;
	document.body.appendChild(script);
}

jQuery(document).on("change", ".input-box", function () {
	var _this = this;
	var yuanurl = jQuery(_this).val();
	if (yuanurl.indexOf('%') != -1) {
		urldecode(jQuery(_this).val(), 'gbk', function (d) {
			jQuery(_this).val(d);
		});
	}
});

jQuery(document).on("change", ".textarea-box", function () {
	var _this = this;
	var yuanurl = jQuery(_this).val();
	if (yuanurl.indexOf('%') != -1) {
		urldecode(jQuery(_this).val(), 'gbk', function (d) {
			jQuery(_this).val(d);
		});
	}
});


jq(document).ready(function () {
	jq('.fkyanse').each(function () {
		jq(this).minicolors({
			control: jq(this).attr('data-control') || 'hue',
			defaultValue: jq(this).attr('data-defaultValue') || '',
			inline: jq(this).attr('data-inline') === 'true',
			letterCase: jq(this).attr('data-letterCase') || 'lowercase',
			opacity: jq(this).attr('data-opacity'),
			position: jq(this).attr('data-position') || 'bottom left',
			change: function (hex, opacity) {
				var log;
				try {
					log = hex ? hex : 'transparent';
					if (opacity) log += ', ' + opacity;
					console.log(log);
				} catch (e) { }
			},
			theme: 'default'
		});
	});

});

if (GetUrlParam("bakid")) {
	yuncundu(GetUrlParam("bakid"));
}